<!DOCTYPE html>
<html>

<head>
  <title>Simple Animation</title>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <script src="js/three.js"></script>
  <script src="js/controls/TrackballControls.js"></script>
  <script src="/js/loaders/GLTFLoader.js"></script>
  <script>
    var scene = new THREE.Scene();
    scene.background = new THREE.Color(0x7ec0ee);

    var aspect = window.innerWidth / window.innerHeight;
    var width = window.innerWidth;
    var height = window.innerHeight;
    var camera = new THREE.OrthographicCamera(width / - 2, width / 2, height / 2, height / - 2, 1, 1000);
    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    controls = new THREE.TrackballControls(camera);

    // light
    var light = new THREE.AmbientLight(0x404040);
    var pointLight = new THREE.PointLight(0xe05702);

    // set its position
    pointLight.position.x = 0;
    pointLight.position.y = 0;
    pointLight.position.z = 0;

    // add to the scene
    scene.add(light);
    scene.add(pointLight);

    // texture
    // instantiate a loader
    var textLoader = new THREE.TextureLoader();
    var sunTexture = textLoader.load("textures/texture_sun.jpg");
    var earthTexture = textLoader.load("textures/1_earth_8k.jpg");
    var moonTexture = textLoader.load("textures/moon-surface1k.jpg");

    // sun
    var geometry = new THREE.SphereGeometry(100, 32, 32);
    //var material = new THREE.MeshNormalMaterial();
    //var material = new THREE.MeshNormalMaterial({ wireframe: true });
    var material = new THREE.MeshBasicMaterial({ map: sunTexture });
    var sun = new THREE.Mesh(geometry, material);
    scene.add(sun);
    camera.position.z = 300;

    // earth
    var earth = new THREE.Mesh(new THREE.SphereGeometry(50, 32, 32), new THREE.MeshPhongMaterial({ map: earthTexture, shininess: 30 }));
    //scene.add(earth);
    //earth.position.x = 200;

    // moon
    var moon = new THREE.Mesh(new THREE.SphereGeometry(20, 32, 32), new THREE.MeshLambertMaterial({ map: moonTexture }));
    //scene.add(moon);
    //moon.position.x = 400;

    // Group earth and moon
    var pivot = new THREE.Group();
    pivot.add(earth);
    pivot.add(moon);

    scene.add(pivot);
    pivot.position.x = 250;
    moon.position.x = 80;

    // --------------------------------------------------------------------------------------------------------------------
    // Running Man
    var mixer;

    var loader = new THREE.GLTFLoader();

    loader.load('models/RunningMan/RunningMan.gltf', function (gltf) {

      scene.add(gltf.scene);
      console.log('gltf', gltf);      // comment it out later
      gltf.scene.position.set(0, -100, 150);
      gltf.scene.scale.set(50, 50, 50);

      mixer = new THREE.AnimationMixer(gltf.scene);   // create global mixer
      var clips = gltf.animations;

      var clip = THREE.AnimationClip.findByName(clips, "metarigAction");
      var action = mixer.clipAction(clip);
      action.play();

    }, undefined, function (error) {

      console.error(error);

    }); // Running Man
    // --------------------------------------------------------------------------------------------------------------------

    var au = 0;
    var clock = new THREE.Clock();
    var render = function () {
      requestAnimationFrame(render);
      au += 0.01;
      pivot.position.x = 250 * Math.sin(au);
      pivot.position.z = 250 * Math.cos(au);
      pivot.rotation.y -= 0.01;
      earth.rotation.y += 0.02;
      controls.update();
      var delta = clock.getDelta();
      if (mixer) mixer.update(delta);
      renderer.render(scene, camera);
    };

    render();
  </script>
</body>

</html>